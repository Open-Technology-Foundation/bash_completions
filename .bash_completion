# Bash completion for bash-completions command
_bash_completions() {
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    # Main commands
    local commands="copy generate symlink version"

    # Global options
    local global_opts="-h --help -v --verbose -q --quiet -V --version"

    # If we're completing the first argument after the command
    if [[ ${COMP_CWORD} -eq 1 ]]; then
        COMPREPLY=( $(compgen -W "${commands} ${global_opts}" -- ${cur}) )
        return 0
    fi

    # Get the command (skip global options)
    local command=""
    local i=1
    while [[ $i -lt ${COMP_CWORD} ]]; do
        case "${COMP_WORDS[$i]}" in
            -h|--help|-v|--verbose|-q|--quiet|-V|--version)
                ((i++))
                ;;
            copy|generate|symlink|version)
                command="${COMP_WORDS[$i]}"
                break
                ;;
            *)
                ((i++))
                ;;
        esac
    done

    case "$command" in
        copy)
            case "$prev" in
                -y|--yes|-h|--help)
                    return 0
                    ;;
                *)
                    local copy_opts="-y --yes -h --help"
                    if [[ "$cur" == -* ]]; then
                        COMPREPLY=( $(compgen -W "${copy_opts}" -- ${cur}) )
                    else
                        # Complete directories
                        COMPREPLY=( $(compgen -d -- ${cur}) )
                    fi
                    ;;
            esac
            ;;
        generate)
            case "$prev" in
                -d|--directory)
                    # Complete directories
                    COMPREPLY=( $(compgen -d -- ${cur}) )
                    return 0
                    ;;
                -v|--verbose|-q|--quiet|-h|--help)
                    return 0
                    ;;
                *)
                    local generate_opts="-d --directory -v --verbose -q --quiet -h --help"
                    if [[ "$cur" == -* ]]; then
                        COMPREPLY=( $(compgen -W "${generate_opts}" -- ${cur}) )
                    else
                        # Complete executable files in current directory or specified directory
                        local dir="."
                        # Check if -d was used earlier
                        local j=1
                        while [[ $j -lt ${COMP_CWORD} ]]; do
                            if [[ "${COMP_WORDS[$j]}" == "-d" || "${COMP_WORDS[$j]}" == "--directory" ]]; then
                                if [[ $((j+1)) -lt ${COMP_CWORD} ]]; then
                                    dir="${COMP_WORDS[$((j+1))]}"
                                fi
                                break
                            fi
                            ((j++))
                        done
                        COMPREPLY=( $(compgen -f -X '!*' -- ${cur}) )
                    fi
                    ;;
            esac
            ;;
        symlink)
            case "$prev" in
                -f|--force|-n|--dry-run|-s|--skip-install|-q|--quiet|-v|--verbose|-h|--help)
                    return 0
                    ;;
                *)
                    local symlink_opts="-f --force -n --dry-run -s --skip-install -q --quiet -v --verbose -h --help"
                    if [[ "$cur" == -* ]]; then
                        COMPREPLY=( $(compgen -W "${symlink_opts}" -- ${cur}) )
                    else
                        # Complete directories
                        COMPREPLY=( $(compgen -d -- ${cur}) )
                    fi
                    ;;
            esac
            ;;
        version)
            # version command takes no arguments
            return 0
            ;;
        *)
            # If no command is recognized, offer commands and global options
            COMPREPLY=( $(compgen -W "${commands} ${global_opts}" -- ${cur}) )
            ;;
    esac

    return 0
}

# Register the completion function
complete -F _bash_completions bash-completions